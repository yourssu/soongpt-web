name: ðŸ˜¡ [Develop] Deploy Alpha
on:
  push:
    branches: [develop]

jobs:
  check_for_deploy_label:
    runs-on: ubuntu-latest
    outputs:
      has_deploy_label: ${{ steps.check-labels.outputs.has-deploy-label }}
    steps:
      - name: ðŸ Checkout Repository
        uses: actions/checkout@v4
      - name: Check for "deploy" label
        id: check-labels
        run: |
          HAS_DEPLOY_LABEL=false
          PR_LIST=$(gh pr list --json labels)
          if echo "$PR_LIST" | grep -q "\"name\":\"deploy\""; then
            HAS_DEPLOY_LABEL=true
          else
            HAS_DEPLOY_LABEL=false
          fi
          echo "has-deploy-label=${HAS_DEPLOY_LABEL}" >> $GITHUB_OUTPUT
  build_alpha:
    needs: check_for_deploy_label
    if: needs.check_for_deploy_label.outputs.has_deploy_label == 'false'
    uses: ./.github/workflows/build-and-deploy.yml
    with:
      STAGE: 'alpha'
      BRANCH_NAME: 'develop'
      CLOUDFLARE_PROJECT_NAME: 'soongpt-web-alpha'
